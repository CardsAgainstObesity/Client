<script setup>
import WSConnection from "@/services/ws.mjs";
import Nav from "@/components/Nav.vue";
import Playerlist from "@/components/Playerlist.vue";
import { game } from "@/services/cards.mjs";
import Room from "@/services/Room.mjs";
import { useRoomStore } from '@/stores/room';

const roomStore = useRoomStore();
game.state = "lobby";

WSConnection.socket.on("RoomConnectionSuccess", () => {
  roomStore.playerlist = Room.playersArr;
});

WSConnection.socket.on("RoomPlayerConnection", () => {
  roomStore.playerlist = Room.playersArr;
});

WSConnection.socket.on("RoomPlayerDisconnection", () => {
  roomStore.playerlist = Room.playersArr;
});
</script>

<script>
export default {
  name: "LobbyView",
  data() {
    return {
      playerlist: [],
      nIntervId: undefined,
    };
  },
  methods: {
    appendplayer(player) {
      const _player = { name: player ? player.name : "YOinkS" };
      this.playerlist.push(_player);
    },
    loadPlayers() {
      if (!this.nIntervId) {
        this.nIntervId = setInterval(() => { // TODO: Esto es muy cutre, debe ser cambiado por algun mecanismo de Vue si es posible.
          this.playerlist = Room.playersArr;
        }, 250);
      }
    },
  },
  mounted() {
    if (Room.roomId == "") this.$router.replace({ name: "index" });
    // this.loadPlayers();
  }
};
</script>

<template>
  <div>
    <Nav />
    <div class="left_padding">
      <main>
        <!-- <button @click="appendplayer()">DEBUG Append player</button>
        <button @click="loadPlayers()">DEBUG Load player</button> -->
        <h1>Jugadores en la partida</h1>
        <Playerlist :list="roomStore.playerlist" :lobby="true" />
      </main>
    </div>
  </div>
</template>